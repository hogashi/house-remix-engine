<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NodeJS House Remix Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse-red {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .processing { animation: pulse-red 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    </style>
</head>
<body class="bg-zinc-950 text-zinc-100 min-h-screen flex flex-col items-center justify-center p-4">
    <div class="max-w-md w-full bg-zinc-900 border border-zinc-800 rounded-2xl p-8 shadow-2xl">
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-black tracking-tighter text-rose-500 mb-2">HOUSE REMIXER</h1>
            <p class="text-zinc-400 text-sm">Convert any song into a 126 BPM House track with sidechain pumping and bass management.</p>
        </header>

        <div id="dropZone" class="border-2 border-dashed border-zinc-700 rounded-xl p-10 flex flex-col items-center justify-center transition-all hover:border-rose-500 hover:bg-zinc-800/50 cursor-pointer">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-zinc-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
            </svg>
            <span id="fileName" class="text-sm font-medium text-zinc-300">Drop MP3 or click to select</span>
            <input type="file" id="fileInput" class="hidden" accept="audio/*">
        </div>

        <div class="mt-8 space-y-4">
            <button id="processBtn" class="w-full bg-rose-600 hover:bg-rose-500 disabled:bg-zinc-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg shadow-rose-900/20">
                GENERATE REMIX
            </button>
            
            <div id="statusContainer" class="hidden text-center space-y-3">
                <div class="flex items-center justify-center space-x-2">
                    <div class="w-2 h-2 bg-rose-500 rounded-full processing"></div>
                    <span id="statusText" class="text-xs uppercase tracking-widest text-zinc-400 font-bold">Analysing Tempo...</span>
                </div>
                <div class="w-full bg-zinc-800 rounded-full h-1.5">
                    <div id="progressBar" class="bg-rose-500 h-1.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <footer class="mt-8 pt-6 border-t border-zinc-800 text-center">
            <p class="text-[10px] text-zinc-500 uppercase tracking-widest">Powered by Node.js & FFmpeg</p>
        </footer>
    </div>

    <script>
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileName = document.getElementById('fileName');
        const processBtn = document.getElementById('processBtn');
        const statusContainer = document.getElementById('statusContainer');
        const statusText = document.getElementById('statusText');
        const progressBar = document.getElementById('progressBar');

        dropZone.onclick = () => fileInput.click();
        
        fileInput.onchange = () => {
            if(fileInput.files[0]) {
                fileName.innerText = fileInput.files[0].name;
                fileName.classList.add('text-rose-400');
            }
        };

        processBtn.onclick = async () => {
            const file = fileInput.files[0];
            if(!file) return alert("Select a song first!");

            const formData = new FormData();
            formData.append('song', file);

            // UI State
            processBtn.disabled = true;
            statusContainer.classList.remove('hidden');
            updateStatus("Slicing & Aligning...", 20);

            try {
                const response = await fetch('/remix', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) throw new Error('Processing error');

                updateStatus("Applying Sidechain...", 70);
                
                const blob = await response.blob();
                updateStatus("Finalizing...", 100);
                
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `house-remix-${Date.now()}.mp3`;
                document.body.appendChild(a);
                a.click();
                
                setTimeout(() => {
                    statusText.innerText = "REMIX COMPLETE";
                    processBtn.disabled = false;
                }, 1000);

            } catch (err) {
                alert("Error: " + err.message);
                processBtn.disabled = false;
                statusContainer.classList.add('hidden');
            }
        };

        function updateStatus(text, progress) {
            statusText.innerText = text;
            progressBar.style.width = progress + '%';
        }
    </script>
</body>
</html>